import streamlit as st
import pandas as pd

st.title("ğŸšŒ 2025ë…„ 5ì›” ë²„ìŠ¤ì •ë¥˜ì¥ë³„ ì´ìš©í˜„í™© ë¶„ì„")

# CSV ì—…ë¡œë“œ
uploaded_file = st.file_uploader("CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš” (EUC-KR ì¸ì½”ë”©)", type="csv")

if uploaded_file:
    # ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    df = pd.read_csv(uploaded_file, encoding="euc-kr")

    # ì‰¼í‘œ ì œê±° í›„ ìˆ«ìë¡œ ë³€í™˜
    df["ìŠ¹ì°¨ìŠ¹ê°ìˆ˜"] = df["ìŠ¹ì°¨ìŠ¹ê°ìˆ˜"].astype(str).str.replace(",", "").astype(int)
    df["í•˜ì°¨ìŠ¹ê°ìˆ˜"] = df["í•˜ì°¨ìŠ¹ê°ìˆ˜"].astype(str).str.replace(",", "").astype(int)

    # ì •ë¥˜ì¥ë³„ë¡œ ìŠ¹í•˜ì°¨ ì¸ì› í•©ì‚°
    grouped = df.groupby("ë²„ìŠ¤ì •ë¥˜ì¥ëª…")[["ìŠ¹ì°¨ìŠ¹ê°ìˆ˜", "í•˜ì°¨ìŠ¹ê°ìˆ˜"]].sum().reset_index()

    # ë¶„ì„ ê¸°ì¤€ ì„ íƒ
    ê¸°ì¤€ = st.radio("ë¶„ì„ ê¸°ì¤€ì„ ì„ íƒí•˜ì„¸ìš”:", ("ìŠ¹ì°¨ìŠ¹ê°ìˆ˜", "í•˜ì°¨ìŠ¹ê°ìˆ˜"))

    # ìƒìœ„ 5ê°œ ì •ë¥˜ì¥ ì¶”ì¶œ
    top5 = grouped.sort_values(by=ê¸°ì¤€, ascending=False).head(5)
    st.subheader(f"ğŸ {ê¸°ì¤€} ê¸°ì¤€ ìƒìœ„ 5ê°œ ì •ë¥˜ì¥")
    st.dataframe(top5)

    # ì‹œê°„ëŒ€ë³„ ìŠ¹í•˜ì°¨ ì •ë³´ê°€ ì¡´ì¬í•œë‹¤ê³  ê°€ì •í•˜ê³ , ì•„ë˜ëŠ” ì˜ˆì‹œ ì‹œê°í™”ìš© ì²˜ë¦¬ì…ë‹ˆë‹¤.
    st.subheader("ğŸ“ˆ ì •ë¥˜ì¥ë³„ ì‹œê°„ëŒ€ë³„ ì´ìš© í˜„í™© (ì˜ˆì‹œ)")

    for ì •ë¥˜ì¥ in top5["ë²„ìŠ¤ì •ë¥˜ì¥ëª…"]:
        # í•´ë‹¹ ì •ë¥˜ì¥ì˜ ëª¨ë“  ì‹œê°„ëŒ€ ë°ì´í„°ë¥¼ í•„í„°ë§ (ì˜ˆì‹œëŠ” ì‹¤ì œ ì‹œê°„ëŒ€ ì»¬ëŸ¼ì´ ì—†ìœ¼ë¯€ë¡œ ë¬´ì‘ìœ„ ìƒì„±)
        sample_data = pd.DataFrame({
            "ì‹œê°„ëŒ€": [f"{h:02d}ì‹œ" for h in range(6, 23)],
            "ìŠ¹ì°¨ì¸ì›": [int(df[df["ë²„ìŠ¤ì •ë¥˜ì¥ëª…"] == ì •ë¥˜ì¥]["ìŠ¹ì°¨ìŠ¹ê°ìˆ˜"].sum() * (0.03 + 0.02 * h)) for h in range(6, 23)]
        }).set_index("ì‹œê°„ëŒ€")

        st.write(f"ğŸšŒ ì •ë¥˜ì¥: {ì •ë¥˜ì¥}")
        st.line_chart(sample_data)

    # ì›ë³¸ ë°ì´í„° ì¶œë ¥
    st.subheader("ğŸ—ƒ ì›ë³¸ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°")
    st.dataframe(df)
